# 优先级任务清单 - DSLighting 改进计划

**版本：** v1.9.7+
**更新时间：** 2026-01-18

---

## 🔴 P0 - 紧急修复（本周必须完成）

### ✅ Task 1: 移除生产代码中的 DEBUG print 语句
**严重性：** 🔴 Critical
**工作量：** 30 分钟
**影响：** 代码质量、用户体验
**负责人：** 待分配
**截止日期：** 2026-01-19

**位置：** `dslighting/core/agent.py:335-591`

**具体行动：**
1. [ ] 搜索所有 `[DEBUG]` print 语句（共 26 处）
2. [ ] 删除或改为 `logger.debug()`
3. [ ] 运行测试确保功能正常
4. [ ] 提交 PR

**验证命令：**
```bash
grep -r "\[DEBUG\]" dslighting/ --include="*.py" | grep -v registry
# 应该返回空或极少数结果
```

---

### ✅ Task 2: 建立测试框架
**严重性：** 🔴 Critical
**工作量：** 0.5 天
**影响：** 代码质量保障
**负责人：** 待分配
**截止日期：** 2026-01-20

**具体行动：**
1. [ ] 创建 `tests/` 目录结构
2. [ ] 编写 `tests/conftest.py`
3. [ ] 配置 `pytest` (pyproject.toml)
4. [ ] 编写第一个示例测试
5. [ ] 配置 GitHub Actions CI

**产出：**
- `tests/conftest.py`
- `tests/unit/test_agent_init.py`
- `.github/workflows/test.yml`

---

### ✅ Task 3: 创建自定义异常类
**严重性：** 🔴 High
**工作量：** 1 小时
**影响：** 错误处理统一性
**负责人：** 待分配
**截止日期：** 2026-01-20

**具体行动：**
1. [ ] 创建 `dslighting/exceptions.py`
2. [ ] 定义 5-6 个核心异常类
3. [ ] 编写异常使用文档
4. [ ] 更新核心模块使用新异常

**产出：**
- `dslighting/exceptions.py`
- `docs/error_handling.md`

---

## 🟡 P1 - 高优先级（2 周内完成）

### ✅ Task 4: 核心模块单元测试
**严重性：** 🟡 High
**工作量：** 3-5 天
**影响：** 测试覆盖率
**负责人：** 待分配
**截止日期：** 2026-02-01

**具体行动：**
1. [ ] 测试 `Agent` 类（初始化、配置）
2. [ ] 测试 `DataLoader`（加载各种数据源）
3. [ ] 测试 `ConfigBuilder`（配置构建）
4. [ ] 测试 `TaskDetector`（任务识别）

**目标覆盖率：** 70%+

**产出：**
- `tests/unit/test_agent.py`
- `tests/unit/test_data_loader.py`
- `tests/unit/test_config_builder.py`
- `tests/unit/test_task_detector.py`

---

### ✅ Task 5: enable_rag 功能测试
**严重性：** 🟡 High
**工作量：** 2 天
**影响：** 新功能验证
**负责人：** 待分配
**截止日期：** 2026-01-25

**具体行动：**
1. [ ] 测试 AutoMind with `enable_rag=False`
2. [ ] 测试 DS-Agent with `enable_rag=False`
3. [ ] 测试 AutoMind with `enable_rag=True` (mock VDBService)
4. [ ] 测试 DS-Agent with `enable_rag=True` (mock VDBService)
5. [ ] 验证 VDBService 不被调用时禁用 RAG

**产出：**
- `tests/integration/test_enable_rag.py`

---

### ✅ Task 6: 轻量依赖选项
**严重性：** 🟡 High
**工作量：** 1 天
**影响：** 安装体验、包大小
**负责人：** 待分配
**截止日期：** 2026-01-24

**具体行动：**
1. [ ] 设计 extras 分组（core, rag, jupyter, all, dev）
2. [ ] 更新 `pyproject.toml`
3. [ ] 测试各分组安装
4. [ ] 更新文档（安装说明）
5. [ ] 测试不同工作流的最小依赖

**产出：**
- 更新的 `pyproject.toml`
- 更新的 `PIP_DOC/README_PIP.md`

---

## 🟢 P2 - 中优先级（1 个月内完成）

### ✅ Task 7: 统一文档语言
**严重性：** 🟢 Medium
**工作量：** 2 天
**影响：** 文档质量、国际用户
**负责人：** 待分配
**截止日期：** 2026-02-10

**具体行动：**
1. [ ] 决定主语言（英文推荐）
2. [ ] 统一代码注释语言
3. [ ] 统一日志消息语言
4. [ ] 统一异常消息语言
5. [ ] 统一文档字符串语言
6. [ ] 更新 README（提供中英文版本）

**检查范围：**
- `dslighting/` 下所有 `.py` 文件
- `dsat/` 核心模块
- `PIP_DOC/` 文档

---

### ✅ Task 8: 补全类型提示
**严重性：** 🟢 Medium
**工作量：** 2 天
**影响：** 类型安全、IDE 支持
**负责人：** 待分配
**截止日期：** 2026-02-15

**具体行动：**
1. [ ] 安装并配置 mypy
2. [ ] 补全公共 API 类型提示
3. [ ] 修复 mypy 错误
4. [ ] 添加到 CI 检查

**重点模块：**
- `dslighting/core/agent.py`
- `dslighting/core/data_loader.py`
- `dslighting/core/config_builder.py`

---

### ✅ Task 9: 重构路径处理逻辑
**严重性：** 🟢 Medium
**工作量：** 1 天
**影响：** 代码质量、可维护性
**负责人：** 待分配
**截止日期：** 2026-02-08

**具体行动：**
1. [ ] 创建 `PathResolver` 类
2. [ ] 提取 `agent.py` 中路径处理逻辑
3. [ ] 简化嵌套 if-else
4. [ ] 添加单元测试
5. [ ] 验证功能正常

**产出：**
- `dslighting/core/path_resolver.py`
- 简化的 `dslighting/core/agent.py`

---

## ⚪ P3 - 低优先级（有时间再做）

### ⏳ Task 10: 增强 CLI 功能
**严重性：** ⚪ Low
**工作量：** 2 天
**影响：** 用户体验
**负责人：** 待分配
**截止日期：** 待定

**具体行动：**
1. [ ] 设计 `run` 命令接口
2. [ ] 实现基本 `run` 命令
3. [ ] 支持配置文件
4. [ ] 添加交互模式
5. [ ] 更新文档

**示例命令：**
```bash
dslighting run --workflow aide --task bike-sharing-demand
dslighting run --config config.yaml
```

---

### ⏳ Task 11: 生成 API 文档
**严重性：** ⚪ Low
**工作量：** 1-2 天
**影响：** 文档完整性
**负责人：** 待分配
**截止日期：** 待定

**具体行动：**
1. [ ] 安装 Sphinx
2. [ ] 创建 `docs/` 目录
3. [ ] 配置 Sphinx
4. [ ] 生成 API 文档
5. [ ] 部署到 GitHub Pages

---

### ⏳ Task 12: 添加进度条
**严重性：** ⚪ Low
**工作量：** 1 天
**影响：** 用户体验
**负责人：** 待分配
**截止日期：** 待定

**具体行动：**
1. [ ] 在 Agent.run() 中添加 tqdm 进度条
2. [ ] 显示迭代进度
3. [ ] 显示估计时间
4. [ ] 测试不同工作流

---

### ⏳ Task 13: 配置文件支持
**严重性：** ⚪ Low
**工作量：** 2 天
**影响：** 用户体验
**负责人：** 待分配
**截止日期：** 待定

**具体行动：**
1. [ ] 设计 YAML 配置格式
2. [ ] 实现 `Agent.from_config()`
3. [ ] 创建示例配置文件
4. [ ] 更新文档

---

## 📊 优先级决策矩阵

| 任务 | 影响 | 紧急性 | 工作量 | 优先级 | 建议时间 |
|------|------|--------|--------|--------|----------|
| 移除 DEBUG prints | 🔴 高 | 🔴 高 | 0.5h | **P0** | 立即 |
| 建立测试框架 | 🔴 高 | 🔴 高 | 0.5d | **P0** | 本周 |
| 创建异常类 | 🟡 中 | 🔴 高 | 1h | **P0** | 本周 |
| 核心单元测试 | 🔴 高 | 🟡 中 | 5d | **P1** | 2周内 |
| enable_rag 测试 | 🟡 中 | 🟡 中 | 2d | **P1** | 2周内 |
| 轻量依赖 | 🟡 中 | 🟡 中 | 1d | **P1** | 2周内 |
| 统一文档语言 | 🟢 低 | 🟢 低 | 2d | **P2** | 1月内 |
| 补全类型提示 | 🟢 低 | 🟢 低 | 2d | **P2** | 1月内 |
| 重构路径处理 | 🟢 低 | 🟢 低 | 1d | **P2** | 1月内 |
| 增强 CLI | ⚪ 低 | ⚪ 低 | 2d | **P3** | 有空 |
| API 文档 | ⚪ 低 | ⚪ 低 | 2d | **P3** | 有空 |
| 进度条 | ⚪ 低 | ⚪ 低 | 1d | **P3** | 有空 |
| 配置文件 | ⚪ 低 | ⚪ 低 | 2d | **P3** | 有空 |

---

## 🎯 里程碑计划

### Milestone 1: v1.9.8 - 紧急修复版
**目标日期：** 2026-01-25（一周内）

**包含任务：**
- [ ] 移除所有 DEBUG prints
- [ ] 创建自定义异常类
- [ ] 建立 pytest 框架
- [ ] 核心模块基础单元测试

**发布说明重点：**
- 代码质量提升
- 测试框架建立
- 错误处理改进

---

### Milestone 2: v1.10.0 - 功能完善版
**目标日期：** 2026-02-15（一个月内）

**包含任务：**
- [ ] 完整的测试套件（70%+ 覆盖率）
- [ ] 轻量依赖选项
- [ ] 统一文档语言
- [ ] 补全类型提示
- [ ] 重构路径处理

**发布说明重点：**
- 测试覆盖完整
- 安装选项优化
- 代码质量显著提升
- 文档统一规范

---

### Milestone 3: v1.11.0 - 体验增强版（可选）
**目标日期：** 2026-03-01（两个月内）

**包含任务：**
- [ ] 增强 CLI 功能
- [ ] 配置文件支持
- [ ] 进度条显示
- [ ] API 文档生成

**发布说明重点：**
- CLI 功能增强
- 用户体验提升
- 完整文档

---

## 📋 工作分配模板

### 开发者 A（代码质量）
- [ ] Task 1: 移除 DEBUG prints
- [ ] Task 3: 创建异常类
- [ ] Task 9: 重构路径处理

### 开发者 B（测试）
- [ ] Task 2: 建立测试框架
- [ ] Task 4: 核心单元测试
- [ ] Task 5: enable_rag 测试

### 开发者 C（依赖与文档）
- [ ] Task 6: 轻量依赖选项
- [ ] Task 7: 统一文档语言
- [ ] Task 8: 补全类型提示

### 开发者 D（体验增强 - 可选）
- [ ] Task 10: 增强 CLI
- [ ] Task 11: API 文档
- [ ] Task 12: 进度条
- [ ] Task 13: 配置文件

---

## 🔄 每周检查清单

### Week 1 检查（2026-01-19）
- [ ] 所有 DEBUG prints 已移除
- [ ] pytest 框架可用
- [ ] 异常类已创建
- [ ] 至少 1 个测试通过

### Week 2 检查（2026-01-26）
- [ ] 核心模块测试覆盖率 > 50%
- [ ] enable_rag 测试完成
- [ ] 轻量依赖选项可用
- [ ] v1.9.8 发布

### Week 3-4 检查（2026-02-09）
- [ ] 文档语言统一
- [ ] 类型提示补全
- [ ] 路径处理重构
- [ ] 测试覆盖率 > 70%

### Week 5-8 检查（2026-03-01）
- [ ] v1.10.0 发布
- [ ] 可选：v1.11.0 规划

---

**最后更新：** 2026-01-18
**下次更新：** 每周五更新进度
**文档维护者：** 待指定
